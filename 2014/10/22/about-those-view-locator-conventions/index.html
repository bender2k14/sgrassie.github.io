
<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Stuart Grassie's Blog">
    <meta name="author" content="Stuart Grassie">
    <meta name="keywords" content="prism,wpf" />
    <title>temporalcohesion.co.uk</title>

    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <!-- Custom styles for this template -->
    <link href="/stylesheets/custom-styles.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="canonical" href="http://www.temporalcohesion.co.uk/2014/10/22/about-those-view-locator-conventions/" />
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">temporalcohesion.co.uk</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
            <li><a href="/archive">Archives</a></li>
          </ul>
	  <ul class="nav navbar-nav navbar-right">
		  <li><a href="http://twitter.com/stugrassie"><img src="/images/twitter.png"></a></li>
		  <li><a href="http://facebook.com/sgrassie"><img src="/images/facebook.png"></a></li>
		  <li><a href="http://uk.linkedin.com/in/sgrassie/"><img src="/images/linkedin.png"></a></li>
	  </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
	

<div class="post">
    <h1 class="title">About those view locator conventions <small>Wednesday, 22, Oct 2014</small></h1>

    
        
    <p>As I mentioned in a previous post, I do not like some of the default PRISM view location conventions.</p>

<p>As a refresher, these are:</p>

<ul>
<li>View models to be located in a folder called ViewModel, named MyAwesomeViewModel</li>
<li>Views to be located in a folder called Views, named MyAwesome</li>
</ul>

<p>It's the view naming that I don't like: In my world (which is based on Caliburn.Micro and ReactiveUI), views should be named MyAwesomeView. This is a simple distinction, but an important one for me because I automatically expect view names to end in View.</p>

<p>Fortunately in PRISM 5, this is easy to change:</p>

<pre><code>ViewModelLocationProvider.SetDefaultViewTypeToViewModelTypeResolver(viewType =&gt;
{
    var viewName = viewType.FullName;
    var viewAssemblyName = viewType.GetTypeInfo().Assembly.FullName;
    var viewModelName = string.Format(CultureInfo.InvariantCulture, " {0}Model, {1} ", viewName.Replace("Views", "ViewModels"), viewAssemblyName);
    return Type.GetType(viewModelName);
});
</code></pre>

<p>We get the full name of the view, and the full name of the assembly, and then replace "Views" for the "ViewModels" folder, and add "Model" to the end. I would call this somewhere in your applications startup, such as in the bootstrapper <code>Run</code>.</p>

<h2>Autowiring</h2>

<p>Something else that you can do in PRISM 5, is autowire the view model and view such that the <code>DataContext</code> of the view is automatically populated. </p>

<pre><code>ViewModelLocationProvider.SetDefaultViewModelFactory(type =&gt; Container.GetInstance(type));
</code></pre>

<p>I'm using StructureMap here (of which I am a big fan), but you should be able to get to work with your favourite IoC library.</p>

<p>This though, means that you have to tell StructureMap about all your views in order for it to be able to resolve them. That's too much messing about remembering having to update a <code>Registry</code> everytime I add a view. StructureMap can solve that for us no problem:</p>

<pre><code>public class ViewRegistrationConvention : IRegistrationConvention
{
    public void Process(Type type, Registry registry)
    {
        if (!type.Name.EndsWith("View") || ! type.IsConcrete()) return ;

        registry.For(typeof(object)).Use(type).Named(type.Name);
    }
}
</code></pre>

<p>Here we say that if the name of the type being resolved ends with "View", and it is a concrete type (i.e. not an abstract class or interface), then add it to the registry.
The trick with PRISM is that it is asking to resolve an <code>object</code> with a specific name, it doesn't try to resolve the type of the view, so adding something to the registry as <code>For&lt;MyAwesomeView&gt;().Use&lt;MyAwesomeView&gt;()</code> won't work, you have to use <code>For(typeof(object))</code> and make it a named instance, using the name of the type. </p>

<p>And then just register the convention when you configure the container:</p>

<pre><code>Container.Configure(configure =&gt;
{
    configure.Scan(scan =&gt;
    {
        ...
        scan.Convention&lt;ViewRegistrationConvention&gt;();
    });
});
</code></pre>

<p>Then from the region manager, you can <code>RequestNavigate("AwesomeRegion", new Uri(typeof(MyAwesomeView)))</code>, or use the extension method in my previous post. </p>


    <div id="disqus_thread"></div>
<script>
    var reset_disqus = function(){
        DISQUS.reset({
            reload: true,
            config: function () {
                //this.page.identifier = '';
                this.page.url = 'http://www.temporalcohesion.co.uk/2014/10/22/about-those-view-locator-conventions/';
                //this.page.title = '';
            }
        });
    };

    var disqus_shortname = 'temporalcohesion';
    var disqus_url = 'http://www.temporalcohesion.co.uk/2014/10/22/about-those-view-locator-conventions/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    window.addEventListener('orientationchange', reset_disqus);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><!--/.post-->

        
        <hr />
        <footer>
            <p>&copy; temporalcohesion.co.uk 2014 | Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a></p>
        </footer>

    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-9870754-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>

    <script src="/javascripts/prettify.js"></script>
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sons-of-obsidian"></script>

    <script src="/javascripts/cohesion.js"></script>
</body>
</html>
