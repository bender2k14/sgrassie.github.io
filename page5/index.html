
<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Stuart Grassie's Blog">
    <meta name="author" content="Stuart Grassie">
    <meta name="keywords" content="annoyance,asp.net,blog,Books,bootstrap,build script,C#,cathartic,Coding,delphi,design patterns,DI,Dropbox,editing,euler,exception,Git,github-api,IoC,Java,jQuery,linux,log4net,Logging,nancy,News,npoco,PHP,Plugin Manager,Powershell,prism,Project Euler,psake,random,RestSharp,sandra.snow,self pity,snow,Source Control,structuremap,thoughts,Uncategorized,vim,winner,wpf" />
    <title>temporalcohesion.co.uk</title>

    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <!-- Custom styles for this template -->
    <link href="/stylesheets/custom-styles.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="canonical" href="http://www.temporalcohesion.co.uk/page5/" />
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">temporalcohesion.co.uk</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
            <li><a href="/archive">Archives</a></li>
          </ul>
	  <ul class="nav navbar-nav navbar-right">
		  <li><a href="http://twitter.com/stugrassie"><img src="/images/twitter.png"></a></li>
		  <li><a href="http://facebook.com/sgrassie"><img src="/images/facebook.png"></a></li>
		  <li><a href="http://uk.linkedin.com/in/sgrassie/"><img src="/images/linkedin.png"></a></li>
	  </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
	

<div class="post">
	<h1 class="title">
		<a href="/2011/11/14/stupid-design-decisions-with-the-github-api-wrapper/">Stupid design decisions with the Github API wrapper</a> <small>Monday, 14 Nov, 2011</small>
	</h1>
   <div class="meta">
	   <ul class="list-unstyled list-inline">
			<li><a href="/category/C#" title="C#">C#</a></li>
			<li><a href="/category/github-api" title="github-api">github-api</a></li>
	   </ul>
   </div>
            
   
   
<p>Whilst writing some blog posts about the authentication which I've been implementing, I've come to the realization, almost as an after thought, that even though I've still not got a lot of the main Github API implemented, the way I've envisioned the API working, from a user point of view, is sort of a bit shit.</p>

<pre class="brush:applescript">var userApi = new UserApi();
var user = userApi.GetUser("example");</pre>

<p>Pretty straightforward, right? What about the as yet unwritten GistApi?</p>

<pre class="brush:csharp">var gistApi = new GistApi();
var gist = gistApi.GetGist(...);</pre>

<p>Again, pretty straightforward. But I see a pattern forming. What am I going to do when it comes to the RepositoryApi?</p>

<pre class="brush:csharp">var reposApi = new RepositoryApi();
var repo = reposApi.GetRepository(...);</pre>

<p>Well, that is starting to look pretty fucking stupid. I've caught myself doing it with other methods as well. I simply cannot believe I've let myself be so stupid. At least there is not that much implemented where I'll have to refactor loads of shit.</p>
 
   <hr />
</div><!--/.post-->
<div class="post">
	<h1 class="title">
		<a href="/2011/11/07/adding-authentication-on-the-fly-to-a-restsharp-client-request/">Adding authentication on the fly to a RestSharp client request</a> <small>Monday, 07 Nov, 2011</small>
	</h1>
   <div class="meta">
	   <ul class="list-unstyled list-inline">
			<li><a href="/category/C#" title="C#">C#</a></li>
			<li><a href="/category/Coding" title="Coding">Coding</a></li>
			<li><a href="/category/github-api" title="github-api">github-api</a></li>
	   </ul>
   </div>
            
   
   
<h1>The Basics</h1>

<p>The typical way that you'd make a request with RestSharp:</p>

<ol>
    <li>Create a RestRequest</li>
    <li>Create a RestClient</li>
    <li>Execute the request with the client</li>
    <li>Do something with the response.</li>
</ol>

<p>It's at the point that you get the client object that you may wish to add authentication. For example with a REST API such as Githubs, certain methods behave differently if the request is authenticated or not, so being able to magically turn on authentication is desirable.</p>

<p>To authenticate a request with RestSharp, it is a simple case of creating a RestRequest, RestClient and an IAuthenticator instance for the authenticating mechanism you want to use. For example:</p>

<pre class="brush:csharp">var client = new RestClient
             {
                 BaseUrl ="https://api.github.com",
                 Authenticator = new HttpBasicAuthenticator(username, password)
             };</pre>

<p>This is pretty straightforward and standard RestSharp usage. You may have a class to encapsulate this functionality, with a method which returns the RestClient instance, probably in a base class in order to inherit this common functionality in other classes.</p>

<pre class="brush:csharp">public abstract class BaseApi
{
    RestClient GetRestClient()
    {
        ...
    }
}</pre>

<h1>Options</h1>

<p>There are several methods which we can use to add authentication dynamically to the RestClient instance, ranging from the trivial to the more involved.</p>

<p>The trivial solution is to add the IAuthenticator as a parameter to the method, which is then assigned to the RestClient when it is created. Easy. Also fairly easy is just make it abstract or virtual and override it in an inheriting class, although this breaks SRP.</p>

<p>Alternatively, we can implement the Decorator pattern, and introduce the authentication in a class which is solely responsible for handing it. I'm not going to go into this in too much detail, there is a wealth of information on implementing this pattern already available on the web. Using a Decorator is valid in a lot of situations, particularly when re-factoring someone else's mess, as you can adhere to the same interface and not risk breaking some important business function. In other cases, it is better to intercept.</p>

<h1>Interception</h1>

<p>A pattern which lends itself to this is called Proxy, and if you spend any time with Google and search terms like "c# proxy pattern" you'll quickly end up finding a lot of information about implementing it. You'll also find interesting stuff about Castle.DynamicProxy, and you may quickly realise this is an excellent way of adding the ability to dynamically intercept a method to add additional functionality on the fly. I've implemented an interceptor in the Github API library, with the core magic being:</p>

<pre class="brush:csharp">public void Intercept(IInvocation invocation)
{
    invocation.Proceed(); // let the RestClient be instantiated as normal.
    var restClient = (RestClient)invocation.ReturnValue;
    restClient.Authenticator = _authenticator; // add the authenticator
    invocation.ReturnValue = restClient;
 }</pre>

<p>I then wrap the interception up in a static class, which is a technique I <a href="http://geekswithblogs.net/BlackRabbitCoder/archive/2010/05/06/c-why-decorate-when-you-can-intercept.aspx">saw on another website</a>, which I then wrap in a extension method which with a little bit of generics hangs off API classes in a fluent manner.</p>

<pre class="brush:csharp">var api = new UserApi(GitHubUrl).WithAuthentication(authenticator);</pre>

<p>I feel like it is the best way to do this sort of thing, and I will certainly starting using more of it, where necessary, in all my projects.</p>
 
   <hr />
</div><!--/.post-->
<div class="post">
	<h1 class="title">
		<a href="/2011/10/31/github-api-handling-authentication/">Github API: Handling authentication</a> <small>Monday, 31 Oct, 2011</small>
	</h1>
   <div class="meta">
	   <ul class="list-unstyled list-inline">
			<li><a href="/category/C#" title="C#">C#</a></li>
			<li><a href="/category/Coding" title="Coding">Coding</a></li>
			<li><a href="/category/github-api" title="github-api">github-api</a></li>
	   </ul>
   </div>
            
   
   
<p>With v3 of the Github REST API, calling a certain methods when unauthenticated will return a limited set of information, and when authenticated will return extra information. One of the things I wanted to do was to make it easy, in a fluent manner, to add authentication to a request. For example:</p>

<pre class="brush:csharp">var a = new UserApi();
var user = a.WithAuthentication(authenticationObject).GetUser("example");
var b = new UserApi().WithAuthentication(authenticationObject);
user = b.GetUser("example");</pre>

<p>Thus making it possible to instantiate an API object without having to authenticate, then when authorization for an action is required, the authentication can be provided. When that actually happens is, I think , something that is an implementation detail best left to future consumers of the library. Assuming I get it finished.</p>

<p>I got bogged down over the course of several months in trying to wrap my head around a clean way of implementing this. Initially I had a good inheritance from an Api base class to the UserApi class - this is sensible, the base Api class does after all contain methods which are going to be common to different classes, such as GistsApi, RepositoriesApi etc.</p>

<p>Then things got a little screwy.</p>

<p>At that point I had the following implemented:</p>

<pre class="brush:csharp">var github = new Github(authenticator);
var user = gitHub.User.GetUser("example");
user.Authenticated.AddEmail("example@example.com");</pre>

<p>Which doesn't seem all that bad. The User property on the Github object was an instance of UserApi. When the example User is fetched, the UserApi object was added an internal instance on the User object. Then the Authenticated property on the User object returned a new AuthenticatedUser, which acted as a wrapper to the internal UserApi instance where the actual AddEmail was hidden as internal.</p>

<p>Needless to say, I knew something was wrong with that, and I spent far too long in coming up with a more elegant solution.</p>

<p>In my second stab at things, I tried to implement Decorator to solve this problem, that is, decorate the UserApi with the additional functionality to add the authentication. The trouble is that the way I wanted to implement the pattern wouldn't have lent itself exceedingly well to having specific functionality for the different parts of the api.</p>

<p>Then I thought to myself, wouldn't it be great if I could intercept the method in the base class which gets the RestClient and add the authentication to it on the fly. A little Googling taught me that this is idealised as the Proxy pattern, from which it was but a short leap to the <a title="The Castle Project" href="http://www.google.co.uk/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CCUQFjAA&amp;url=http%3A%2F%2Fwww.castleproject.org%2F&amp;rct=j&amp;q=castle%20project&amp;ei=5hqHTu3bCKnH0QXsgPXvDw&amp;usg=AFQjCNEUSLcxGcsnLhC_LQOSuUFdNZLizw&amp;cad=rja" target="_blank">Castle project </a>and <a title="Castle DynamicProxy" href="http://www.castleproject.org/dynamicproxy/index.html" target="_blank">DynamicProxy</a>.</p>

<p>&nbsp;</p>
 
   <hr />
</div><!--/.post-->
<div class="post">
	<h1 class="title">
		<a href="/2011/09/26/is-this-thing-on/">Is this thing on?</a> <small>Monday, 26 Sep, 2011</small>
	</h1>
   <div class="meta">
	   <ul class="list-unstyled list-inline">
			<li><a href="/category/Uncategorized" title="Uncategorized">Uncategorized</a></li>
	   </ul>
   </div>
            
   
   
<p>Despite many months of not posting anything on this blog (OK, nearly a year) I am returning with another post about my on/off project to write a C# library to access the Github REST API. Much like my blogging schedule, which can arguably be said to be none-existent, my pet-project�s suffer from the same cruel lack of... habit.</p>

<p>To recap this particular project, you may like to browse some of the earlier posts on it, wherein I grandly proclaim my intent to write a �Github API in C#�. Which I should really have finished by now. As you will have no doubt realised, I do suffer from a certain amount of laziness. That is a subject for another blog post. To my shame, I can tell you that the amount of Github�s REST API which I�m covering is minimal, limited to a subset of the available User related commands.</p>

<p>Moving swiftly along, with no trace of irony.</p>

<p>In the months since the start of this project, Github has release v3 of their REST API, which contains many updated and/or new methods to access the whole plethora of the functionality available on Github. Indeed, they have even gone as far as to release a desktop client for Mac�s, and for all I know are working on a Windows version, which would then render this effort of mine (because that�s what I�ve always intended) redundant.</p>

<p>So, despite not blogging about it, and despite going months between commits, I have been working on the library. The RestSharp git sub-module is gone (I mean, who likes sub-modules anyway?) in favour of the NuGet package. The authentication has been reworked slightly (still no OAuth yet) and the API is a little more fluenty.</p>

<p>Of course, it still doesn�t actually let you do very much, I mean even after a year, you still can�t perform all of the actions available to a user. This is terrible, and speaks volumes about me, as a person. Procrastination is my enemy.</p>
 
   <hr />
</div><!--/.post-->
<div class="post">
	<h1 class="title">
		<a href="/2010/11/15/getting-paid-to-do-something-you-love-doing-is-awesome/">Getting paid to do something you love doing is awesome!</a> <small>Monday, 15 Nov, 2010</small>
	</h1>
   <div class="meta">
	   <ul class="list-unstyled list-inline">
			<li><a href="/category/Coding" title="Coding">Coding</a></li>
			<li><a href="/category/Coding" title="Coding">Coding</a></li>
			<li><a href="/category/thoughts" title="thoughts">thoughts</a></li>
	   </ul>
   </div>
            
   
   
<p>A lot of people who work, don't like their job. It's a fact. If you were at a party and you asked people if they like the job they get paid to do, the response would be largely negative. That you are reading this, on this blog, indicates that you are probably a programmer. Then, on the assumption that you are in some capacity employed as a programmer, I can say to you that you are a lucky person.</p>

<p>Why?</p>

<p>It is simple, really: A large percentage of the programmers I have met,� have worked with or follow on Twitter absolutely love to write code, whether it is for a website, a desktop application of some kind or they are just monkeying around with something. They love it! I love doing it. A number of my friends love doing it. And the best thing?</p>

<p>We get paid to do it!</p>

<p>Don't get me wrong here, I know plenty of people who turn up at 9am and go home at 5pm and wouldn't even consider writing anything for themselves or doing any open source work. For them, it's like a factory job, albeit a (generally) much better paid one. Jeff Atwood (love him or loathe him) has a great post about these sorts of programmers titled <a title="There are Two Types of Programmers - codinghorror.com" href="http://www.codinghorror.com/blog/2007/11/the-two-types-of-programmers.html" target="_blank">"There are Two Types of Programmers"</a>. Even though these programmers might not code in their spare time, I'd still say that 99% still like their job.</p>

<p>I'll place myself firmly in that 20% block of programmers though. I wouldn't say I was a rock star programmer, I'm certainly not bad, but I do always want to constantly improve myself and my ability. As the old saying, "Practice makes perfect". I definitely love my job. Maybe I could do without some of the meetings and the office politics which comes from working in a large company, but still, I love what I do.</p>

<p>I get paid to do what I love doing; I consider myself lucky.</p>
 
   <hr />
</div><!--/.post-->

  <!-- Pagination links -->
  <div id="post-pagination" class="pagination">

   
      <p class="previous">
        <a href="/page4">Previous Page</a>
        </p>


    <p class="previous">
      <a href="/page6">Next Page</a>
    </p>

  </div>


        
        <hr />
        <footer>
            <p>&copy; temporalcohesion.co.uk 2014 | Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a></p>
        </footer>

    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-9870754-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>

    <script src="/javascripts/prettify.js"></script>
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sons-of-obsidian"></script>

    <script src="/javascripts/cohesion.js"></script>
</body>
</html>
